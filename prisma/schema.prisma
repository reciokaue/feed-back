generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// datasource db {
//   provider = "sqlite"
//   url      = "file:./dev.db"
// }

generator erd {
  provider                  = "prisma-erd-generator"
  output                    = "ERD.svg"
  theme                     = "neutral"
  disableEmoji              = true
  includeRelationFromFields = true
}

model User {
  id          Int    @id @default(autoincrement())
  name        String
  email       String @unique
  password    String
  accessLevel Int

  forms Form[] @relation("UserForms")
}

model Form {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  active      Boolean
  logoUrl     String?
  public      Boolean
  createdAt   DateTime @default(now())
  userId      Int

  user       User        @relation(fields: [userId], references: [id], name: "UserForms")
  questions  Question[]
  sessions   Session[]
  formTopics FormTopic[]
}

model Question {
  id     Int    @id @default(autoincrement())
  text   String
  type   String
  index  Int
  formId Int

  form      Form       @relation(fields: [formId], references: [id])
  options   Option[]
  responses Response[]
}

model Option {
  id         Int    @id @default(autoincrement())
  text       String
  index      Int
  questionId Int

  question  Question   @relation(fields: [questionId], references: [id])
  responses Response[]
}

model QuestionType {
  id   Int    @id @default(autoincrement())
  name String
}

model Session {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  formId    Int

  form      Form       @relation(fields: [formId], references: [id])
  responses Response[]
}

model Response {
  id         Int      @id @default(autoincrement())
  text       String
  createdAt  DateTime @default(now())
  sessionId  Int
  questionId Int
  optionId   Int

  session  Session  @relation(fields: [sessionId], references: [id])
  question Question @relation(fields: [questionId], references: [id])
  option   Option   @relation(fields: [optionId], references: [id])
}

model Topic {
  id   Int    @id @default(autoincrement())
  name String

  formTopics FormTopic[]
}

model FormTopic {
  formId  Int
  topicId Int

  form  Form  @relation(fields: [formId], references: [id])
  topic Topic @relation(fields: [topicId], references: [id])

  @@id([formId, topicId])
}
